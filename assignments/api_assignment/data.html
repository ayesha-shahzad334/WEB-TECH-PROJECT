<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Users CRUD App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-light">

<div class="container py-4">
  <h2 class="text-center mb-4">Users CRUD App </h2>

  
  <div id="loading" class="text-center my-3" style="display:none;">
    <div class="spinner-border text-primary" role="status"></div>
    <p>Loading...</p>
  </div>

  <table class="table table-bordered table-striped text-center">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
      </tr>
    </thead>
    <tbody id="userTable"></tbody>
  </table>


  <div class="card mx-auto" style="max-width: 500px;">
    <div class="card-body">
      <h4 id="formTitle" class="text-center mb-3"> crud operations </h4>
      <div class="mb-2">
        <input type="number" id="userId" class="form-control" placeholder="Enter ID for Update/Delete">
      </div>
      <div class="mb-2">
        <input type="text" id="name" class="form-control" placeholder="Enter Name">
      </div>
      <div class="mb-2">
        <input type="text" id="email" class="form-control" placeholder="Enter Email">
      </div>
      <div class="d-flex justify-content-center gap-2">
        <button id="addBtn" class="btn btn-success">Add</button>
        <button id="updateBtn" class="btn btn-primary">Update</button>
        <button id="deleteBtn" class="btn btn-danger">Delete</button>
        <button id="resetBtn" class="btn btn-secondary">Reset</button>
      </div>
    </div>
  </div>
</div>

<script>
const apiUrl = "https://jsonplaceholder.typicode.com/users";
let users = []; 


function showTable() {
  let rows = "";
  users.forEach(u => {
    rows += `<tr>
               <td>${u.id}</td>
               <td>${u.name}</td>
               <td>${u.email}</td>
             </tr>`;
  });
  $("#userTable").html(rows);
}


function loadUsers() {
  $("#loading").show();
  $.ajax({
    url: apiUrl,
    method: "GET",
    success: function(data) {
      $("#loading").hide();
      users = data.slice(0, 10); 
      showTable();
    },
    error: function() {
      $("#loading").hide();
      alert("Error loading users!");
    }
  });
}


$("#addBtn").click(function() {
  const name = $("#name").val().trim();
  const email = $("#email").val().trim();

  if (!name || !email.includes("@")) { alert("Enter valid Name and Email!"); return; }

  $.ajax({
    url: apiUrl,
    method: "POST",
    data: { name, email },
    success: function(newUser) {
      newUser.id = users.length ? users[users.length-1].id + 1 : 1; // Simulate ID
      users.push(newUser);
      showTable();
      alert("User added successfully!");
      resetForm();
    },
    error: function() { alert("Error adding user!"); }
  });
});


$("#updateBtn").click(function() {
  const id = parseInt($("#userId").val());
  const name = $("#name").val().trim();
  const email = $("#email").val().trim();

  if (!id || !name || !email.includes("@")) { alert("Fill ID, Name, and Email for update!"); return; }

  $.ajax({
    url: `${apiUrl}/${id}`,
    method: "PUT",
    data: { name, email },
    success: function() {
      const user = users.find(u => u.id === id);
      if(user) { user.name = name; user.email = email; }
      showTable();
      alert("User updated successfully!");
      resetForm();
    },
    error: function() { alert("Error updating user!"); }
  });
});


$("#deleteBtn").click(function() {
  const id = parseInt($("#userId").val());
  if (!id) { alert("Enter User ID to delete!"); return; }
  if (!confirm("Are you sure to delete this user?")) return;

  $.ajax({
    url: `${apiUrl}/${id}`,
    method: "DELETE",
    success: function() {
      users = users.filter(u => u.id !== id);
      showTable();
      alert("User deleted successfully!");
      resetForm();
    },
    error: function() { alert("Error deleting user!"); }
  });
});


function resetForm() {
  $("#userId").val("");
  $("#name").val("");
  $("#email").val("");
  $("#formTitle").text("Add New User");
}


$("#userTable").on("click", "tr", function() {
  const cols = $(this).find("td");
  if(cols.length > 0) {
    $("#userId").val(cols.eq(0).text());
    $("#name").val(cols.eq(1).text());
    $("#email").val(cols.eq(2).text());
    $("#formTitle").text("Edit User");
  }
});

$("#resetBtn").click(resetForm);


window.onload = loadUsers;

</script>
</body>
</html>
